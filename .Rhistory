"väike", "NA")) %>%
filter(tunnus == "väike")
sonaga_kohanimed$hex_id <- sprintf("ID%s",
over(SpatialPoints(coordinates(data.frame(sonaga_kohanimed[,c(11, 10)])),
CRS(proj4string(est_hex_polys))),
est_hex_polys))
est_heat <- count(sonaga_kohanimed, tunnus, hex_id)
est_heat$log <- log(est_heat$n)
# määra värvid
bin_ct <- 20  # palju erinevaid toone kasutatakse
no_fill <- "#fde725"  # ilma kohtadeta ruutude värv
vir <- rev(viridis_pal()(bin_ct+1))
vir_col <- col_bin(vir[2:length(vir)],
range(est_heat$log),
bins = bin_ct,
na.color = no_fill)
est_heat$fill <- vir_col(est_heat$log)
library(ggiraph)
proov <- ggplot() +
geom_map(data = est_hex_map, map = est_hex_map,
aes(x=long, y=lat, map_id=id),
size=0.6, color="#ffffff", fill=no_fill) +
geom_map_interactive(data=est_heat, map=est_hex_map,
aes(fill=fill, map_id=hex_id, tooltip = hex_id),
color="#ffffff", size=0.6) +
scale_fill_identity(na.value=no_fill) +
theme_map() +
theme(plot.title = element_text(size = 22, colour = "#614949")) +
ggtitle(str_c("-", "sona", "-")) +
annotate("text", x = 25.2, y = 57.5, label = str_c(nrow(sonaga_kohanimed),
" kohta"),
colour = "#c5b1b1", size = 6) +
coord_proj("+init=epsg:3301")
ggiraph(code = {print(proov)}, width = 7, height = 5)
proov <- ggplot() +
geom_map(data = est_hex_map, map = est_hex_map,
aes(x=long, y=lat, map_id=id),
size=0.6, color="#ffffff", fill=no_fill) +
geom_map_interactive(data=est_heat, map=est_hex_map,
aes(fill=fill, map_id=hex_id, tooltip = hex_id),
color="#ffffff", size=0.6) +
scale_fill_identity(na.value=no_fill) +
theme_map() +
theme(plot.title = element_text(size = 22, colour = "#614949")) +
ggtitle(str_c("-", "väike", "-")) +
annotate("text", x = 25.2, y = 57.5, label = str_c(nrow(sonaga_kohanimed),
" kohta"),
colour = "#c5b1b1", size = 6) +
coord_proj("+init=epsg:3301")
ggiraph(code = {print(proov)}, width = 7, height = 5)
devtools::install_github("ropensci/plotly")
install.packages("ggplot2")
devtools::install_github("ropensci/plotly")
library(plotly)
load("output/algandmed.RData")
library(extrafont)
library(dplyr)
library(stringr)
library(ggplot2)
library(readr)
library(scales)
library(ggthemes)
library(ggalt)
library(sp)
library(viridis)
library(gridExtra)
setwd("C:/Users/toomase/Dropbox/DataScience/R/kohanimed")
load("output/algandmed.RData")
source("R/eesti_hexabin.R")
sonaga_kohanimed <- kohanimed %>%
mutate(tunnus = ifelse(str_detect(str_to_lower(kohanimi), str_to_lower("väike")),
"väike", "NA")) %>%
filter(tunnus == "väike")
# Määra Eesti hexabin aluskaardi järgi igale asukohale tema ruudu id
sonaga_kohanimed$hex_id <- sprintf("ID%s",
over(SpatialPoints(coordinates(data.frame(sonaga_kohanimed[,c(11, 10)])),
CRS(proj4string(est_hex_polys))),
est_hex_polys))
# loenda kohtade arv igas hexabin ruudus
est_heat <- count(sonaga_kohanimed, tunnus, hex_id)
# kasuta log skaalat kohtade arvust (vajalik värvimiseks)
est_heat$log <- log(est_heat$n)
# määra värvid
bin_ct <- 20  # palju erinevaid toone kasutatakse
no_fill <- "#fde725"  # ilma kohtadeta ruutude värv
vir <- rev(viridis_pal()(bin_ct+1))
vir_col <- col_bin(vir[2:length(vir)],
range(est_heat$log),
bins = bin_ct,
na.color = no_fill)
# kasuta värvimiseks log skaalal kohtade arvu
est_heat$fill <- vir_col(est_heat$log)
# joonista teemakaart
ggplot() +
# aluskaart
geom_map(data = est_hex_map, map = est_hex_map,
aes(x=long, y=lat, map_id=id),
size=0.6, color="#ffffff", fill=no_fill) +
# sõna sisaldavate kohtade arv kaardile
geom_map(data=est_heat, map=est_hex_map,
aes(fill=fill, map_id=hex_id),
color="#ffffff", size=0.6) +
scale_fill_identity(na.value=no_fill) +
theme_map(base_family = "Lucida Sans") +
theme(plot.title = element_text(size = 16, colour = "#614949")) +
ggtitle(str_c("-", "väike", "-")) +
annotate("text", x = 25.2, y = 57.5, label = str_c(nrow(sonaga_kohanimed),
" kohta"),
colour = "#c5b1b1") +
coord_proj("+init=epsg:3301")  # sobiv projektsioon
}
proov <- ggplot() +
geom_map(data = est_hex_map, map = est_hex_map,
aes(x=long, y=lat, map_id=id),
size=0.6, color="#ffffff", fill=no_fill) +
geom_map_interactive(data=est_heat, map=est_hex_map,
aes(fill=fill, map_id=hex_id, tooltip = hex_id),
color="#ffffff", size=0.6) +
scale_fill_identity(na.value=no_fill) +
theme_map() +
theme(plot.title = element_text(size = 22, colour = "#614949")) +
ggtitle(str_c("-", "sona", "-")) +
annotate("text", x = 25.2, y = 57.5, label = str_c(nrow(sonaga_kohanimed),
" kohta"),
colour = "#c5b1b1", size = 6) +
coord_proj("+init=epsg:3301")
ggiraph(code = {print(proov)}, width = 7, height = 5)
proov <- ggplot() +
geom_map(data = est_hex_map, map = est_hex_map,
aes(x=long, y=lat, map_id=id),
size=0.6, color="#ffffff", fill=no_fill) +
geom_map_interactive(data=est_heat, map=est_hex_map,
aes(fill=fill, map_id=hex_id, tooltip = hex_id),
color="#ffffff", size=0.6) +
scale_fill_identity(na.value=no_fill) +
theme_map() +
theme(plot.title = element_text(size = 22, colour = "#614949")) +
ggtitle(str_c("-", "sona", "-")) +
annotate("text", x = 25.2, y = 57.5, label = str_c(nrow(sonaga_kohanimed),
" kohta"),
colour = "#c5b1b1", size = 6) +
coord_proj("+init=epsg:3301")
ggiraph(code = {print(proov)}, width = 7, height = 5)
library(ggiraph)
proov <- ggplot() +
geom_map(data = est_hex_map, map = est_hex_map,
aes(x=long, y=lat, map_id=id),
size=0.6, color="#ffffff", fill=no_fill) +
geom_map_interactive(data=est_heat, map=est_hex_map,
aes(fill=fill, map_id=hex_id, tooltip = hex_id),
color="#ffffff", size=0.6) +
scale_fill_identity(na.value=no_fill) +
theme_map() +
theme(plot.title = element_text(size = 22, colour = "#614949")) +
ggtitle(str_c("-", "sona", "-")) +
annotate("text", x = 25.2, y = 57.5, label = str_c(nrow(sonaga_kohanimed),
" kohta"),
colour = "#c5b1b1", size = 6) +
coord_proj("+init=epsg:3301")
ggiraph(code = {print(proov)}, width = 7, height = 5)
ggplotly(proov)
uus <- ggplot() +
# aluskaart
geom_map(data = est_hex_map, map = est_hex_map,
aes(x=long, y=lat, map_id=id),
size=0.6, color="#ffffff", fill=no_fill) +
# sõna sisaldavate kohtade arv kaardile
geom_map(data=est_heat, map=est_hex_map,
aes(fill=fill, map_id=hex_id),
color="#ffffff", size=0.6) +
scale_fill_identity(na.value=no_fill) +
theme_map(base_family = "Lucida Sans") +
theme(plot.title = element_text(size = 16, colour = "#614949")) +
ggtitle(str_c("-", "väike", "-")) +
annotate("text", x = 25.2, y = 57.5, label = str_c(nrow(sonaga_kohanimed),
" kohta"),
colour = "#c5b1b1") +
coord_proj("+init=epsg:3301")  # sobiv projektsioon
uus
ggplotly(uus)
library(plotly)
library(maps)
# This example modifies code from Hadley Wickham -- https://gist.github.com/hadley/233134
# It also uses data from Nathan Yau's flowingdata site -- http://flowingdata.com/
unemp <- read.csv("http://datasets.flowingdata.com/unemployment09.csv")
names(unemp) <- c("id", "state_fips", "county_fips", "name", "year",
"?", "?", "?", "rate")
unemp$county <- tolower(gsub(" County, [A-Z]{2}", "", unemp$name))
unemp$state <- gsub("^.*([A-Z]{2}).*$", "\\1", unemp$name)
county_df <- map_data("county")
names(county_df) <- c("long", "lat", "group", "order", "state_name", "county")
county_df$state <- state.abb[match(county_df$state_name, tolower(state.name))]
county_df$state_name <- NULL
state_df <- map_data("state")
choropleth <- merge(county_df, unemp, by = c("state", "county"))
choropleth <- choropleth[order(choropleth$order), ]
choropleth$rate_d <- cut(choropleth$rate, breaks = c(seq(0, 10, by = 2), 35))
# provide a custom tooltip to plotly with the county name and actual rate
choropleth$text <- with(choropleth, paste0("County: ", name, "<br>Rate: ", rate))
p <- ggplot(choropleth, aes(long, lat, group = group)) +
geom_polygon(aes(fill = rate_d, text = text),
colour = alpha("white", 1/2), size = 0.2) +
geom_polygon(data = state_df, colour = "white", fill = NA) +
scale_fill_brewer(palette = "PuRd") + theme_void()
# just show the text aesthetic in the tooltip
ggplotly(p, tooltip = "text")
crimes <- data.frame(state = tolower(rownames(USArrests)), USArrests)
crimesm <- tidyr::gather(crimes, variable, value, -state)
states_map <- map_data("state")
g <- ggplot(crimesm, aes(map_id = state)) +
geom_map(aes(fill = value), map = states_map) +
expand_limits(x = states_map$long, y = states_map$lat) +
facet_wrap( ~ variable) + theme_void()
ggplotly(g)
ggplot() +
# aluskaart
geom_map(data = est_hex_map, map = est_hex_map,
aes(x=long, y=lat, map_id=id),
size=0.6, color="#ffffff", fill=no_fill)
uus <- ggplot() +
# aluskaart
geom_map(data = est_hex_map, map = est_hex_map,
aes(x=long, y=lat, map_id=id),
size=0.6, color="#ffffff", fill=no_fill)
ggplotly(uus)
ggplot() +
# aluskaart
geom_map(data = est_hex_map, map = est_hex_map,
aes(x=long, y=lat, map_id=id),
size=0.6, color="#ffffff)
uus <- ggplot() +
# aluskaart
geom_map(data = est_hex_map, map = est_hex_map,
aes(x=long, y=lat, map_id=id),
size=0.6, color="#ffffff)
uus <- ggplot() +
# aluskaart
geom_map(data = est_hex_map, map = est_hex_map,
aes(x=long, y=lat, map_id=id),
size=0.6, color="#ffffff")
uus <- ggplot() +
# aluskaart
geom_map(data = est_hex_map, map = est_hex_map,
aes(x=long, y=lat, map_id=id),
size=0.6, color="#ffffff")
ggplotly(uus)
ggiraph(code = {print(uus)}, width = 7, height = 5)
eesti_hexabin("mõis")
library(extrafont)
library(dplyr)
library(stringr)
library(ggplot2)
library(readr)
library(scales)
library(ggthemes)
library(ggalt)
library(sp)
library(viridis)
library(gridExtra)
load("C:/Users/toomase/Dropbox/DataScience/R/kohanimed/output/algandmed.RData")
source("C:/Users/toomase/Dropbox/DataScience/R/kohanimed/R/eesti_hexabin.R")
mois <- eesti_hexabin("mõis")
getwd()
library(svglite)
svglite("mois.svg", width = 10, height = 7)
eesti_hexabin("mõis")
dev.off()
install.packages("rsvg")
library(rsvg)
bitmap <- rsvg("mois.svg")
dim(bitmap)
png::writePNG(bitmap, "bitmap.png")
jpeg::writeJPEG(bitmap, "bitmap.jpg", quality = 1)
getwd()
library(extrafont)
library(dplyr)
library(stringr)
library(ggplot2)
library(readr)
library(scales)
library(ggthemes)
library(ggalt)
library(sp)
library(viridis)
library(gridExtra)
load("C:/Users/toomase/Dropbox/DataScience/R/kohanimed/output/algandmed.RData")
source("C:/Users/toomase/Dropbox/DataScience/R/kohanimed/R/eesti_hexabin.R")
mois <- eesti_hexabin("mõis")
ggsav("mois.png", mois)
ggsave("mois.png", mois)
ggsave("mois.png", mois, ddi = 72)
ggsave("mois.png", mois, dpi = 72)
ggsave("mois.png", mois)
ggsave("mois.png", mois, dpi = 150)
ggsave("mois.png", mois, dpi = 300)
library(extrafont)
library(dplyr)
library(stringr)
library(ggplot2)
library(readr)
library(scales)
library(ggthemes)
library(ggalt)
library(sp)
library(viridis)
library(gridExtra)
load("C:/Users/toomase/Dropbox/DataScience/R/kohanimed/output/algandmed.RData")
source("C:/Users/toomase/Dropbox/DataScience/R/kohanimed/R/eesti_hexabin.R")
mois <- eesti_hexabin("mõis")
kirik <- eesti_hexabin("kirik")
loss <- eesti_hexabin("loss")
talu <- eesti_hexabin("talu")
grid.arrange(mois, kirik, loss, talu, ncol = 2, nrow = 2)
must <- eesti_hexabin("must")
valge <- eesti_hexabin("valge")
grid.arrange(must, valge, ncol = 2)
pikk <- eesti_hexabin("pikk")
luhike <- eesti_hexabin("lühike")
grid.arrange(pikk, luhike, ncol = 2)
suur <- eesti_hexabin("suur")
vaike <- eesti_hexabin("väike")
must <- eesti_hexabin("must")
valge <- eesti_hexabin("valge")
pikk <- eesti_hexabin("pikk")
luhike <- eesti_hexabin("lühike")
uus <- eesti_hexabin("uus")
vana <- eesti_hexabin("vana")
grid.arrange(suur, vaike, must, valge, pikk, luhike, uus, vana, ncol = 2, nrow = 4)
library(extrafont)
library(dplyr)
library(stringr)
library(ggplot2)
library(readr)
library(scales)
library(ggthemes)
library(ggalt)
library(sp)
library(viridis)
library(gridExtra)
load("C:/Users/toomase/Dropbox/DataScience/R/kohanimed/output/algandmed.RData")
source("C:/Users/toomase/Dropbox/DataScience/R/kohanimed/R/eesti_hexabin.R")
eesti_hexabin("mets")
eesti_hexabin("vere")
eesti_hexabin("salu")
eesti_hexabin("mäe")
eesti_hexabin("oru")
eesti_hexabin("kalda")
eesti_hexabin("ranna")
eesti_hexabin("by")
eesti_hexabin("nõmme")
eesti_hexabin("kalmistu")
eesti_hexabin("surnu")
eesti_hexabin("lai")
eesti_hexabin("laia")
eesti_hexabin("lai")
eesti_hexabin("kitsa")
eesti_hexabin("joa")
eesti_hexabin("oja")
eesti_hexabin("jõe")
eesti_hexabin("järv")
eesti_hexabin("kalda")
eesti_hexabin("oru")
eesti_hexabin("pais")
eesti_hexabin("kivi")
eesti_hexabin("kalju")
eesti_hexabin("vete")
eesti_hexabin("peipsi")
eesti_hexabin("nõmme")
eesti_hexabin("vene")
eesti_hexabin("soome")
eesti_hexabin("rootsi")
eesti_hexabin("läti")
eesti_hexabin("x")
eesti_hexabin("z")
eesti_hexabin("org")
eesti_hexabin("mägi")
eesti_hexabin("org")
eesti_hexabin("f")
eesti_hexabin("q")
eesti_hexabin("š")
eesti_hexabin("bb")
eesti_hexabin("kuning")
eesti_hexabin("kuninga")
eesti_hexabin("presidendi")
eesti_hexabin("presitendi")
eesti_hexabin("presi")
eesti_hexabin("keisri")
eesti_hexabin("tooma")
eesti_hexabin("toomas")
eesti_hexabin("jaanika")
eesti_hexabin("tooma")
eesti_hexabin("matsi")
eesti_hexabin("ants")
eesti_hexabin("juku")
eesti_hexabin("maie")
eesti_hexabin("tants")
eesti_hexabin("antsu")
eesti_hexabin("mats")
eesti_hexabin("miku")
eesti_hexabin("mardi")
eesti_hexabin("jüri")
eesti_hexabin("jaani")
eesti_hexabin("kalle")
eesti_hexabin("tõnis")
eesti_hexabin("õõ")
eesti_hexabin("tõnise")
eesti_hexabin("tõnis")
antsu <- eesti_hexabin("antsu")
mardi <- eesti_hexabin("mardi")
juri <- eesti_hexabin("jüri")
tooma <- eesti_hexabin("tooma")
miku <- eesti_hexabin("miku")
jaani <- eesti_hexabin("jaani")
matsi <- eesti_hexabin("matsi")
tonise <- eesti_hexabin("tõnise")
grid.arrange(tooma, tonise, antsu, juri, miku, mardi, jaani, matsi,
ncol = 2, nrow = 4)
eesti_hexabin("peetri")
eesti_hexabin("mobiil")
eesti_hexabin("kala")
eesti_hexabin("kilu")
eesti_hexabin("ahven")
eesti_hexabin("karu")
eesti_hexabin("lõvi")
eesti_hexabin("hundi")
eesti_hexabin("jänese")
eesti_hexabin("kitse")
eesti_hexabin("põdra")
eesti_hexabin("hiire")
eesti_hexabin("linnu")
eesti_hexabin("looma")
eesti_hexabin("kala")
eesti_hexabin("pääsu")
eesti_hexabin("kotka")
eesti_hexabin("siili")
eesti_hexabin("konna")
eesti_hexabin("rebase")
eesti_hexabin("koera")
eesti_hexabin("kasse")
eesti_hexabin("kassi")
eesti_hexabin("haugi")
eesti_hexabin("madrus")
eesti_hexabin("kapten")
eesti_hexabin("kindral")
eesti_hexabin("päts")
eesti_hexabin("meri")
eesti_hexabin("mere")
eesti_hexabin("ussi")
karu <- eesti_hexabin("karu")
hundi <- eesti_hexabin("hundi")
janese <- eesti_hexabin("jänese")
rebase <- eesti_hexabin("rebase")
koera <- eesti_hexabin("koera")
kassi <- eesti_hexabin("kassi")
siili <- eesti_hexabin("siili")
hiire <- eesti_hexabin("hiire")
grid.arrange(karu, hundi, janese, rebase, koera, kassi, siili, hiire,
ncol = 2, nrow = 4)
eesti_hexabin("järve")
eesti_hexabin("jõe")
eesti_hexabin("oja")
eesti_hexabin("joa")
eesti_hexabin("järv")
eesti_hexabin("jõgi")
eesti_hexabin("saar")
eesti_hexabin("tamm")
eesti_hexabin("kuusk")
eesti_hexabin("kuuse")
eesti_hexabin("tamme")
eesti_hexabin("kase")
eesti_hexabin("lepa")
View(kohanimed)
eesti_hexabin("raua")
eesti_hexabin("vase")
eesti_hexabin("lille")
eesti_hexabin("suplus")
eesti_hexabin("põllu")
eesti_hexabin("kesk")
eesti_hexabin("ida")
eesti_hexabin("lääne")
eesti_hexabin("lõuna")
eesti_hexabin("põhja")
eesti_hexabin("kagu")
eesti_hexabin("põhja")
eesti_hexabin("ida")
eesti_hexabin("lääne")
eesti_hexabin("sõbra")
eesti_hexabin("nisu")
eesti_hexabin("rukki")
eesti_hexabin("suvila")
eesti_hexabin("üle")
eesti_hexabin("alla")
eesti_hexabin("sinine")
eesti_hexabin("sinise")
eesti_hexabin("sisse")
eesti_hexabin("välja")
eesti_hexabin("sepa")
eesti_hexabin("veski")
eesti_hexabin("liiva")
eesti_hexabin("männi")
eesti_hexabin("kooli")
eesti_hexabin("maasika")
eesti_hexabin("vaarika")
eesti_hexabin("mäda")
eesti_hexabin("muna")
eesti_hexabin("männiku")
eesti_hexabin("põllu")
eesti_hexabin("männiku")
eesti_hexabin("lõvi")
eesti_hexabin("koer")
eesti_hexabin("kassi")
eesti_hexabin("lehma")
